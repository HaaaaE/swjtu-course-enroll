# 西南交大选课助手 使用教程

一个基于 Tkinter 的西南交通大学自动选课工具，支持双教务系统同时抢课，具备验证码自动识别功能。

## 功能特性

- 🔐 **双系统登录**：自动识别并登录 `jwc.swjtu.edu.cn` 和 `jiaowu.swjtu.edu.cn/TMS` 两个教务系统
- 🤖 **验证码自动识别**：基于模板匹配的 OCR 技术，自动识别登录验证码
- ⚡ **高并发抢课**：双系统同时提交选课请求，提高成功率
- 📝 **课程管理**：支持添加、删除、查询课程，配置自动保存
- 📊 **实时日志**：图形化界面显示运行状态和选课结果
- 🔄 **智能重试**：自动重试未选上的课程，可自定义间隔时间

## 环境要求

- Python 3.12
- 依赖库：
  - `requests` - HTTP 请求
  - `beautifulsoup4` (bs4) - HTML 解析
  - `Pillow` - 图像处理和 OCR
  - `tkinter` - 图形界面（Python 自带）

## 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone <项目地址>
   cd swjtu-course-enroll
   ```

2. **安装依赖**
   ```bash
   pip install requests beautifulsoup4 pillow
   ```


## 使用教程

### 1. 启动程序

```bash
python main.py
```

程序会打开图形化界面。

### 2. 登录账号


- **学号**：输入你的学号（如 `2023112590`）
- **密码**：输入教务系统密码
- **保存账号**：勾选后会将账号密码保存到 config.json，下次自动填充
- 点击 **登录** 按钮

程序会自动：
1. 检测两个教务系统的网络协议（HTTP/HTTPS）
2. 获取并识别验证码（最多重试 10 次）
3. 尝试登录两个系统
4. 显示登录状态：`✓ URL1 | ✓ URL2`（绿色表示成功）

### 3. 添加课程

1. 在 **选课编号** 输入框输入选课编号（如 `B2766`）
2. 在 **备注** 输入框可选填说明，防止你自己忘记选课编号对应的课程，也可以不填写
3. **需要教材** 对应教务处选课的该选项
4. 点击 **添加到列表**

程序会自动查询该课程的真实 ID 并添加到选课列表。

### 4. 管理课程列表

课程列表显示：
- **选课编号**：你输入的课程编号
- **真实ID**：系统查询到的课程真实ID（用于提交选课请求）
- **备注**：你自己写的说明
- **需要教材**：是/否
- **状态**：未选 / ✓已选上

**操作按钮**：
- **删除选中**：选中一行或多行后，删除这些课程
- **清除已选状态**：将所有课程的"已选上"状态重置为"未选"
- **刷新列表**：重新从配置文件加载课程

### 5. 开始抢课

1. **设置重试间隔**：每轮抢课之间的等待时间（秒），建议 0.5-1 秒
2. **设置最大并发数量**：推荐设置为需要抢的课程数量的 6 倍，默认 20
3. 点击 **开始抢课**

**抢课机制**：
- 程序会循环检测未选上的课程
- 对每门课程，同时向两个教务系统url提交选课请求
- 使用线程池并发提交请求，线程数由"最大并发数量"设置决定，详见下方说明
- 成功选上某门课程后，该课程标记为"✓已选上"，不再重复提交
- 所有课程都选上后自动停止

**最大并发数量参数说明：**

- 这个数字决定程序同时发送并且等待多少个选课请求
- **举例**：
  - 每一轮会请求未选上的每门课程两次（两个系统各一次）
  - 下一轮抢课不会等待上一轮完成
  - 假如设置间隔为0.5秒，未选上课程有10门，并发数量设置为 50
  - 每轮会发送 10 门 × 2 系统 = 20 个请求
  - 由于选课时教务系统响应较慢，假设每个请求在0.5秒都内无法得到结果
  - 等待时间结束后依旧有 20 个请求占着位置
  - 但是还有 30 个空闲的位置，可以立即开始发送下一轮的 20 个请求
  - 这样就不会因为等待上轮请求结果而浪费时间
- 数字越大，同时发送的请求越多，抢课约保险
- 太大的数字可能会导致本地网络或教务系统压力过大，反而影响抢课效果
- 推荐设置为需要抢的课程数量的 6 倍

1. **查看运行日志**：右侧日志区域实时显示：
   - 登录状态
   - 每轮抢课的进度
   - 选课成功/失败信息
   - 错误提示

2. **停止抢课**：随时点击 **停止抢课** 按钮

### 6. 配置文件说明

程序会自动在项目目录生成 config.json：

```json
{
  "username": "你的学号",
  "password": "你的密码",
  "max_workers": 20,                // 并发数量（同时发送请求的数量）
  "courses": [
    {
      "teach_id": "B2766",           // 选课编号
      "real_teach_id": "05E431BA...", // 真实ID
      "remark": "高等数学",           // 备注
      "need_book": true,              // 是否需要教材
      "selected": false               // 是否已选上
    }
  ]
}
```

你也可以手动编辑此文件批量添加课程。

## 注意事项

⚠️ **免责声明**：
- 本工具仅供学习交流使用
- 请遵守学校选课规定，合理使用
- 使用本工具产生的一切后果由使用者自行承担

**祝你选课成功！🎉**

如有问题，请检查运行日志或联系开发者。